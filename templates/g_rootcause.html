<!doctype html>
<html>

<head>
     <title>{{xlat.graph_rootcause}}</title>
     <link href="../static/bootstrap.min.css" rel="stylesheet">
     <script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
     <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.2.1/Chart.bundle.js"></script>
     <script src="../static/bootstrap.min.js"></script>
     <style>
     canvas {
          -moz-user-select: none;
          -webkit-user-select: none;
          -ms-user-select: none;
     }
     </style>
</head>

<body>
     <div style="width: 75%">
          <canvas id="canvas"></canvas>
          <a href="/"><button class="btn btn-success" style="margin-left: 2em;">{{xlat.home}}</button></a>
     </div>

     <script>
     var randomScalingFactor = function() {
          return (Math.random() > 0.5 ? 1.0 : -1.0) * Math.round(Math.random() * 100);
     };
     var randomColorFactor = function() {
          return Math.round(Math.random() * 255);
     };

     my_labels = [];
     my_data = [];

     jQuery.ajax({
          type:     "POST",
          url:      "/data_routecause",
          success:  function(sql_data){

               for (i=0; i<sql_data.length; i++) {
                    my_labels.push(sql_data[i].en);
                    my_data.push(sql_data[i].total);
               }

               $.each(barChartData.datasets, function(i, dataset) {
                    dataset.backgroundColor = 'rgba(' + randomColorFactor() + ',' + randomColorFactor() + ',' + randomColorFactor() + ',.7)';
                    dataset.data = my_data;
               });
               window.myBar.update();
          }
     });

     // var barChartData = {
     //      labels: ["January", "February", "March", "April", "May", "June", "July"],
     //      datasets: [{
     //           label: 'Dataset 1',
     //           backgroundColor: "rgba(220,220,220,0.5)",
     //           data: [randomScalingFactor(), randomScalingFactor(), randomScalingFactor(), randomScalingFactor(), randomScalingFactor(), randomScalingFactor(), randomScalingFactor()]
     //      }, {
     //           label: 'Dataset 2',
     //           backgroundColor: "rgba(151,187,205,0.5)",
     //           data: [randomScalingFactor(), randomScalingFactor(), randomScalingFactor(), randomScalingFactor(), randomScalingFactor(), randomScalingFactor(), randomScalingFactor()]
     //      }, {
     //           label: 'Dataset 3',
     //           backgroundColor: "rgba(151,187,205,0.5)",
     //           data: [randomScalingFactor(), randomScalingFactor(), randomScalingFactor(), randomScalingFactor(), randomScalingFactor(), randomScalingFactor(), randomScalingFactor()]
     //      }]
     //
     // };

     var barChartData = {
          labels: my_labels,
          datasets: [{
               // label: 'Failures by Root Cause',
               label: '{{xlat.graph_rootcause}}',
               backgroundColor: "rgba(220,220,220,0.5)",
               data: my_data
          }]

     };
     window.onload = function() {
          var ctx = document.getElementById("canvas").getContext("2d");
          window.myBar = new Chart(ctx, {
               type: 'bar',
               data: barChartData,
               options: {
                    title:{
                         display:true,
                         text:"{{xlat.graph_rootcause}}"
                    },
                    tooltips: {
                         mode: 'label'
                    },
                    responsive: true,
                    scales: {
                         xAxes: [{
                              stacked: true,
                         }],
                         yAxes: [{
                              stacked: true
                         }]
                    }
               }
          });
     };
     </script>
</body>

</html>
